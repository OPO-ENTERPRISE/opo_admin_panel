<div class="dialog-container add-questions-dialog">
    <h2 mat-dialog-title>
        <mat-icon>quiz</mat-icon> Añadir Preguntas desde Otros Temas
    </h2>
    <mat-dialog-content class="dialog-content">
        <div class="topic-info">
            <p><strong>Tema destino:</strong> {{ data.topicTitle }}</p>
        </div>
        <!-- Filtros -->
        <div class="filters-section">
            <mat-form-field appearance="outline" class="search-field">
                <mat-label>Buscar temas</mat-label>
                <input matInput [formControl]="searchControl" placeholder="Escriba para filtrar por nombre..." />
                <mat-icon matPrefix>search</mat-icon>
            </mat-form-field>
            <mat-form-field appearance="outline" class="area-field">
                <mat-label>Área</mat-label>
                <mat-select [formControl]="areaFilter">
                    <mat-option *ngFor="let option of areaOptions" [value]="option.value"> {{ option.label }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <!-- Loading spinner -->
        <div *ngIf="isLoading" class="loading-container">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Cargando temas disponibles...</p>
        </div>
        <!-- Tabla de temas -->
        <div *ngIf="!isLoading" class="table-container">
            <table mat-table [dataSource]="filteredTopics" class="topics-table">
                <!-- Checkbox column -->
                <ng-container matColumnDef="select">
                    <th mat-header-cell *matHeaderCellDef>
                        <mat-checkbox [checked]="isAllSelected()" [indeterminate]="isIndeterminate()"
                            (change)="onSelectAll($event.checked)" [disabled]="isCopying">
                        </mat-checkbox>
                    </th>
                    <td mat-cell *matCellDef="let topic">
                        <mat-checkbox [checked]="isTopicSelected(topic.uuid)"
                            (change)="onSelectTopic(topic.uuid, $event.checked)" [disabled]="isCopying">
                        </mat-checkbox>
                    </td>
                </ng-container>
                <!-- Title column -->
                <ng-container matColumnDef="title">
                    <th mat-header-cell *matHeaderCellDef>Tema</th>
                    <td mat-cell *matCellDef="let topic">
                        <div class="topic-title">
                            <strong>{{ topic.title }}</strong>
                            <span class="topic-type" *ngIf="topic.isMain">(Principal)</span>
                        </div>
                    </td>
                </ng-container>
                <!-- Area column -->
                <ng-container matColumnDef="area">
                    <th mat-header-cell *matHeaderCellDef>Área</th>
                    <td mat-cell *matCellDef="let topic">
                        <span class="area-badge" [class]="'area-' + topic.area"> {{ getAreaName(topic.area) }} </span>
                    </td>
                </ng-container>
                <!-- Subtopic count column -->
                <ng-container matColumnDef="subtopicCount">
                    <th mat-header-cell *matHeaderCellDef>Subtemas</th>
                    <td mat-cell *matCellDef="let topic">
                        <span class="count-badge">
                            <mat-icon>folder</mat-icon> {{ topic.subtopicCount }} </span>
                    </td>
                </ng-container>
                <!-- Question count column -->
                <ng-container matColumnDef="questionCount">
                    <th mat-header-cell *matHeaderCellDef>Preguntas</th>
                    <td mat-cell *matCellDef="let topic">
                        <span class="count-badge" [class]="topic.questionCount > 0 ? 'has-questions' : 'no-questions'">
                            <mat-icon>quiz</mat-icon> {{ topic.questionCount }} </span>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
            <!-- No data message -->
            <div *ngIf="filteredTopics.length === 0 && !isLoading" class="no-data">
                <mat-icon>info</mat-icon>
                <p>No se encontraron temas disponibles</p>
            </div>
        </div>
        <!-- Selection summary -->
        <div *ngIf="selectedTopics.size > 0" class="selection-summary">
            <mat-icon>info</mat-icon>
            <div class="summary-content">
                <p><strong>{{ getSelectedCount() }}</strong> tema(s) seleccionado(s)</p>
                <p><strong>{{ getTotalQuestionsToCopy() }}</strong> pregunta(s) se copiarán</p>
            </div>
        </div>
    </mat-dialog-content>
    <mat-dialog-actions align="end" class="dialog-actions">
        <button mat-stroked-button (click)="onCancel()" [disabled]="isCopying">
            <mat-icon>cancel</mat-icon> Cancelar </button>
        <button mat-raised-button color="primary" (click)="onCopyQuestions()"
            [disabled]="selectedTopics.size === 0 || isCopying">
            <mat-spinner *ngIf="isCopying" diameter="20"></mat-spinner>
            <mat-icon *ngIf="!isCopying">content_copy</mat-icon> {{ isCopying ? 'Copiando...' : 'Copiar Preguntas' }}
        </button>
    </mat-dialog-actions>
</div>
