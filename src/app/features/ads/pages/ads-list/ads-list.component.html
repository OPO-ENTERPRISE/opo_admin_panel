<mat-card>
    <mat-card-header>
        <mat-card-title>
            <div class="header-container">
                <h2>Gestión de Publicidad</h2>
                <button mat-raised-button color="primary" (click)="onCreateAd()">
                    <mat-icon>add</mat-icon> Nuevo Anuncio </button>
            </div>
        </mat-card-title>
    </mat-card-header>
    <mat-card-content>
        <!-- Filtros -->
        <div class="filters-container">
            <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Buscar</mat-label>
                <input matInput [formControl]="searchControl" placeholder="Nombre o Placement ID" />
                <mat-icon matPrefix>search</mat-icon>
            </mat-form-field>
            <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Proveedor</mat-label>
                <mat-select [formControl]="providerFilter">
                    <mat-option *ngFor="let option of providerOptions" [value]="option.value"> {{ option.label }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Tipo</mat-label>
                <mat-select [formControl]="typeFilter">
                    <mat-option *ngFor="let option of typeOptions" [value]="option.value"> {{ option.label }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Pantalla</mat-label>
                <mat-select [formControl]="screenFilter">
                    <mat-option *ngFor="let option of screenOptions" [value]="option.value"> {{ option.label }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Estado</mat-label>
                <mat-select [formControl]="statusFilter">
                    <mat-option *ngFor="let option of statusOptions" [value]="option.value"> {{ option.label }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <button mat-stroked-button (click)="clearFilters()" class="clear-filters-btn">
                <mat-icon>clear</mat-icon> Limpiar filtros </button>
        </div>
        <!-- Loading Spinner -->
        <div *ngIf="isLoading" class="loading-container">
            <mat-spinner></mat-spinner>
        </div>
        <!-- Tabla de anuncios -->
        <div *ngIf="!isLoading" class="table-container">
            <table mat-table [dataSource]="filteredAds" class="ads-table">
                <!-- Name Column -->
                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef>Nombre</th>
                    <td mat-cell *matCellDef="let ad">
                        <strong>{{ ad.name }}</strong>
                    </td>
                </ng-container>
                <!-- Provider Column -->
                <ng-container matColumnDef="provider">
                    <th mat-header-cell *matHeaderCellDef>Proveedor</th>
                    <td mat-cell *matCellDef="let ad">
                        <mat-chip [class]="'provider-' + ad.provider"> {{ getProviderLabel(ad.provider) }} </mat-chip>
                    </td>
                </ng-container>
                <!-- Type Column -->
                <ng-container matColumnDef="type">
                    <th mat-header-cell *matHeaderCellDef>Tipo</th>
                    <td mat-cell *matCellDef="let ad"> {{ getTypeLabel(ad.type) }} </td>
                </ng-container>
                <!-- App Screen Column -->
                <ng-container matColumnDef="appScreen">
                    <th mat-header-cell *matHeaderCellDef>Pantalla</th>
                    <td mat-cell *matCellDef="let ad">
                        <mat-chip class="screen-chip">{{ getScreenLabel(ad.appScreen) }}</mat-chip>
                    </td>
                </ng-container>
                <!-- Active Status Column -->
                <ng-container matColumnDef="active">
                    <th mat-header-cell *matHeaderCellDef>Estado</th>
                    <td mat-cell *matCellDef="let ad">
                        <mat-chip [class]="ad.active ? 'status-active' : 'status-inactive'"> {{ ad.active ? 'Activo' :
                            'Inactivo' }} </mat-chip>
                    </td>
                </ng-container>
                <!-- Updated At Column -->
                <ng-container matColumnDef="updatedAt">
                    <th mat-header-cell *matHeaderCellDef>Última actualización</th>
                    <td mat-cell *matCellDef="let ad"> {{ formatDate(ad.updatedAt || '') }} </td>
                </ng-container>
                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef>Acciones</th>
                    <td mat-cell *matCellDef="let ad" class="actions-cell">
                        <button mat-icon-button color="primary" (click)="onToggleStatus(ad)"
                            [matTooltip]="ad.active ? 'Desactivar' : 'Activar'">
                            <mat-icon>{{ ad.active ? 'toggle_on' : 'toggle_off' }}</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onEditAd(ad)" matTooltip="Editar">
                            <mat-icon>edit</mat-icon>
                        </button>
                        <button mat-icon-button color="warn" (click)="onDeleteAd(ad)" matTooltip="Eliminar">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                <!-- Empty State -->
                <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell empty-state" colspan="7">
                        <mat-icon>campaign</mat-icon>
                        <p *ngIf="ads.length === 0">No hay anuncios registrados</p>
                        <p *ngIf="ads.length > 0 && filteredAds.length === 0"> No se encontraron anuncios con los
                            filtros aplicados </p>
                    </td>
                </tr>
            </table>
        </div>
        <!-- Results count -->
        <div *ngIf="!isLoading" class="results-count"> Mostrando {{ filteredAds.length }} de {{ ads.length }} anuncios
        </div>
    </mat-card-content>
</mat-card>
