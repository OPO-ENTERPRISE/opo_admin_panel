<div class="provider-form-container">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Cargando proveedor...</p>
    </div>
    <!-- Form -->
    <div *ngIf="!isLoading" class="form-content">
        <mat-card>
            <mat-card-header>
                <div class="header-content">
                    <button mat-icon-button (click)="onCancel()" class="back-button">
                        <mat-icon>arrow_back</mat-icon>
                    </button>
                    <mat-card-title>
                        <mat-icon>store</mat-icon> {{ title }} </mat-card-title>
                </div>
            </mat-card-header>
            <mat-card-content>
                <form [formGroup]="providerForm" (ngSubmit)="onSubmit()" class="provider-form">
                    <div class="form-grid">
                        <!-- Provider ID -->
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>ID del Proveedor</mat-label>
                            <input matInput formControlName="providerId" placeholder="admob, facebook, unity..."
                                [readonly]="isEditMode" />
                            <mat-icon matPrefix>fingerprint</mat-icon>
                            <mat-hint>Identificador único (slug), solo minúsculas y guiones</mat-hint>
                            <mat-error *ngIf="providerId_field?.hasError('required')"> El ID es requerido </mat-error>
                            <mat-error *ngIf="providerId_field?.hasError('minlength')"> Mínimo 2 caracteres </mat-error>
                            <mat-error *ngIf="providerId_field?.hasError('maxlength')"> Máximo 50 caracteres
                            </mat-error>
                        </mat-form-field>
                        <!-- Name -->
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Nombre del Proveedor</mat-label>
                            <input matInput formControlName="name" placeholder="AdMob, Facebook Audience Network..." />
                            <mat-icon matPrefix>label</mat-icon>
                            <mat-hint>Nombre visible del proveedor</mat-hint>
                            <mat-error *ngIf="name?.hasError('required')"> El nombre es requerido </mat-error>
                            <mat-error *ngIf="name?.hasError('minlength')"> Mínimo 3 caracteres </mat-error>
                            <mat-error *ngIf="name?.hasError('maxlength')"> Máximo 100 caracteres </mat-error>
                        </mat-form-field>
                        <!-- Icon -->
                        <mat-form-field appearance="outline" class="half-width">
                            <mat-label>Icono (Material Icon)</mat-label>
                            <input matInput formControlName="icon" placeholder="ads_click, campaign..." />
                            <mat-icon matPrefix>{{ icon?.value || 'ads_click' }}</mat-icon>
                            <mat-hint>Nombre del icono de Material Icons</mat-hint>
                        </mat-form-field>
                        <!-- Color -->
                        <mat-form-field appearance="outline" class="half-width">
                            <mat-label>Color (Hex)</mat-label>
                            <input matInput type="color" formControlName="color" />
                            <mat-icon matPrefix>palette</mat-icon>
                            <mat-hint>Color representativo del proveedor</mat-hint>
                        </mat-form-field>
                        <!-- Order -->
                        <mat-form-field appearance="outline" class="half-width">
                            <mat-label>Orden</mat-label>
                            <input matInput type="number" formControlName="order" />
                            <mat-icon matPrefix>sort</mat-icon>
                            <mat-hint>Orden de visualización (0-999)</mat-hint>
                            <mat-error *ngIf="order?.hasError('required')"> El orden es requerido </mat-error>
                            <mat-error *ngIf="order?.hasError('min')"> Mínimo 0 </mat-error>
                            <mat-error *ngIf="order?.hasError('max')"> Máximo 999 </mat-error>
                        </mat-form-field>
                        <!-- Enabled Toggle -->
                        <div class="toggle-field half-width">
                            <label class="toggle-label">Estado</label>
                            <mat-slide-toggle formControlName="enabled" color="primary"> {{ providerForm.value.enabled ?
                                'Habilitado' : 'Deshabilitado' }} </mat-slide-toggle>
                        </div>
                    </div>
                    <!-- Preview -->
                    <div class="preview-section" *ngIf="providerForm.value.name">
                        <h3>Vista Previa</h3>
                        <div class="preview-chip">
                            <mat-icon [style.color]="providerForm.value.color"> {{ providerForm.value.icon ||
                                'ads_click' }} </mat-icon>
                            <span>{{ providerForm.value.name }}</span>
                        </div>
                    </div>
                    <!-- Actions -->
                    <div class="form-actions">
                        <button mat-stroked-button type="button" (click)="onCancel()" [disabled]="isSaving">
                            <mat-icon>cancel</mat-icon> Cancelar </button>
                        <button mat-raised-button color="primary" type="submit"
                            [disabled]="providerForm.invalid || isSaving">
                            <mat-spinner *ngIf="isSaving" diameter="20"></mat-spinner>
                            <mat-icon *ngIf="!isSaving">save</mat-icon> {{ isSaving ? 'Guardando...' : (isEditMode ?
                            'Actualizar' : 'Crear') }} </button>
                    </div>
                </form>
            </mat-card-content>
        </mat-card>
    </div>
</div>
